<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CitasDrive - Sistema de Gestión de Citas</title>

    <!-- bootstrap css -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
    <!-- Navbar-->
    <div id="navbar-container">
        <nav class="navbar navbar-dark bg-dark fixed-top" style="width: 250px; height: 100vh; left: 0; z-index: 1000;">
            <div class="container-fluid flex-column h-100 py-3">
                <!-- Logo genérico -->
                <a class="navbar-brand mb-4" href="#"
                   data-bind="click: function() { navBarViewModel.changeModule({id: 'dashboard'}) }">
                    <i class="bi bi-calendar-check me-2"></i>
                    CitasDrive
                </a>

                <!-- Menú -->
                <ul class="nav nav-pills flex-column w-100">
                    <!-- Dashboard -->
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#"
                           data-bind="click: function() { navBarViewModel.changeModule({id: 'dashboard'}) }">
                            <i class="bi bi-house"></i>
                            <span class="ms-2">Dashboard</span>
                        </a>
                    </li>

                    <!-- Pacientes -->
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#"
                           data-bind="click: function() { navBarViewModel.changeModule({id: 'patients'}) }">
                            <i class="bi bi-people"></i>
                            <span class="ms-2">Pacientes</span>
                        </a>
                    </li>

                    <!-- Citas -->
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#"
                           data-bind="click: function() { navBarViewModel.changeModule({id: 'appointments'}) }">
                            <i class="bi bi-calendar"></i>
                            <span class="ms-2">Citas</span>
                        </a>
                    </li>
                </ul>

                <!-- versión genérica -->
                <div class="text-white-50 small mt-auto">
                    v0.2.1
                </div>
            </div>
        </nav>
    </div>

    <!-- TopBar -->
    <div id="topbar-container">
        <nav class="navbar navbar-light bg-white border-bottom fixed-top"
             style="margin-left: 250px; height: 60px; z-index: 999;">
            <div class="container-fluid justify-content-end">
                <span class="navbar-text me-3">Hola, Usuario</span>
                <button class="btn btn-outline-danger btn-sm"
                        data-bind="click: topBarViewModel.logout">
                    <i class="bi bi-box-arrow-right"></i>
                    Cerrar Sesión
                </button>
            </div>
        </nav>
    </div>

    <!-- contenido main -->
    <main id="main-content" class="container-fluid"
          style="margin-left: 250px; margin-top: 60px; padding: 20px; min-height: calc(100vh - 60px);">
        
        <div class="welcome-message">
            <h1>Bienvenido a CitasDrive</h1>
            <p class="lead">Selecciona un módulo desde el menú de la izquierda.</p>
        </div>
    </main>

    <!-- Modal -->
    <div id="modal-container"></div>

    <!-- librerías -->
    <script src="js/libraries/jquery-3.7.1.min.js"></script>
    <script src="js/libraries/bootstrap.bundle.min.js"></script>
    <script src="js/libraries/knockout-3.5.1.js"></script>

    <!-- viewmodels -->
    <script src="js/viewmodels/appViewModel.js"></script>
    <script src="js/viewmodels/patientsViewModel.js"></script>

    <!-- componentes -->
    <script src="js/components/navbar/NavBar.js"></script>
    <script src="js/components/topbar/TopBar.js"></script>
    <script src="js/components/modal/Modal.js"></script>

    <!-- Bindings application -->
    <script>
        document.addEventListener('DOMContentLoaded', function () { //esto solo aplica bindings cuando se ha cargado todo el index, para evitar errores, se puede optimizar
            console.log('Aplicando bindings...');

            try {
                ko.applyBindings(appViewModel, document.body);
                console.log('Bindings aplicados correctamente');

                appViewModel.mostrarDashboard();

            } catch (error) {
                console.error('Error aplicando bindings:', error);
            }
        });
    </script>
</body>
</html>